{% extends "outline.html" %}

{% block title %} Experiment Dashboard {% endblock %}

{% block sidebar %}{% endblock %}

{% block body %}
<div class="container-fluid" style ='background-color: #FFFFFF; padding-bottom: 1cm; text-align: center'>
    <h2 id="header">Experiment Dashboard: {{ exp_uid }}</h2>

</div>

<script type="text/javascript">
    plot_response = function(data) {
        data.json['width'] = 1000
        data.json['height'] = 100
        mpld3.draw_figure("api_activity_histogram_processAnswer", data.json);
    }

    data = next_widget.getWidget(
    {
    'app_id': "{{ app_id }}",
    'exp_uid': "{{ exp_uid }}",
    'name': 'getStats',
    'widget_key': "{{ perm_key }}",
    'args':{
    'stat_id' : 'api_activity_histogram',
    'params'  : {'task':'processAnswer'}
    }
    },
    plot_response
    );
</script>
<script>
// To pop up documnetation on the plots
popup_alert = function(text){
    document.getElementById("question-info").innerHTML = '<h4>' + text + '</h4>';
  $("#info").modal().show()
};
</script>

<!-- Question mark/info Modal -->
<div class="modal fade" id="info" tabindex="-1" role="button" aria-labelledby="" aria-hidden="true" data-keyboard="false">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-body" id="question-info" style='text-align:center;'>
      </div>
      <center>
      <button type="button" class="btn btn-danger" data-dismiss="modal" onclick="">Dismiss</button>
      </center>
      <br>
    </div>
  </div>
</div>

<div class="container-fluid" style ='padding-bottom: 1cm'>
    <div class="col-lg-10 col-lg-offset-1">
        <div class="row">
            <h2> Experiment info </h2>
        </div>
        <div class="row">
            <p>
            <b> app_id: </b> {{ app_id }} <br>
            <b> exp_id: </b> {{ exp_uid }} <br>
            <b> exp_key: </b> {{ exp_key }} <br>
            <b> Start date: </b> {{ exp_start_data }} <br>
            <b> Number of participants: </b> {{ num_participants }} <br>
            <b> Number of answers: </b> {{ num_queries }} <br>
            <b> Logs: </b> {{ host_url }}/api/experiment/{{ exp_uid }}/{{ exp_key }}/logs
            </p>
        </div>
    </div>
</div>

<!--################## response times #################### -->
<div class="container-fluid" style ='background-color: #FFFFFF; padding-bottom: 1cm'>
    <div class="col-lg-10 col-lg-offset-1">
        <div class="row">
            <h2> Activity
            <button type="button" class="btn btn-primary btn-xs"
                  onclick="popup_alert('This is a graph of when people responded. The x-axis is a datetime string and the y-axis is the number of responses recorded.')">?</button>
            </h2>
        </div>
    <div class="col-lg-10 col-lg-offset-1" style"display: inline-block">
        <div id = "api_activity_histogram_processAnswer"></div>
    </div>
</div>

<!--################## compute_duration_multiline_plot #################### -->
<div class="container-fluid" style ='background-color: #FFFFFF; padding-bottom: 1cm'>
    <div class="col-lg-10 col-lg-offset-1">
        <div class="row">
            <h2> Algorithm timing comparison
            <button type="button" class="btn btn-primary btn-xs"
                  onclick="popup_alert('How long each leg in <a href=\'\'>this image</a> takes. This is shown for each algorithm.<br>x-axis: API call.<br>y-axis: Time in seconds.<br>title: The leg in the image')">?</button>
            </h2>
        </div>
        <div class="row">
            <div class="col-md-3">
                <div id = "compute_duration_multiline_plot_getQuery"></div>
            </div>
            <div class="col-md-3">
                <div id = "compute_duration_multiline_plot_processAnswer"></div>
            </div>
            <div class="col-md-3">
                <div id = "compute_duration_multiline_plot_predict"></div>
            </div>
            <div class="col-md-3">
                <div id = "compute_duration_multiline_plot_daemonProcess"></div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    plot_response = function(data) {
        data.json['width'] = 250
        data.json['height'] = 250
        mpld3.draw_figure("compute_duration_multiline_plot_getQuery", data.json);
    }

    data = next_widget.getWidget(
        {
        "app_id": "{{ app_id }}",
        "exp_uid": "{{ exp_uid }}",
        'name': 'getStats',
        'widget_key': "{{ perm_key }}",
        "args":{
        "stat_id" : "compute_duration_multiline_plot",
        "params"  : {"task": "getQuery" } }
        },
        plot_response
        )

    plot_response = function(data) {
        data.json['width'] = 250
        data.json['height'] = 250
        mpld3.draw_figure("compute_duration_multiline_plot_processAnswer", data.json);
    }

    data = next_widget.getWidget(
        {
        "app_id": "{{ app_id }}",
        "exp_uid": "{{ exp_uid }}",
        'name': 'getStats',
        'widget_key': "{{ perm_key }}",
        "args":{
        "stat_id" : "compute_duration_multiline_plot",
        "params"  : {"task": "processAnswer" } }
        },
        plot_response
        )

    plot_response = function(data) {
        data.json['width'] = 250
        data.json['height'] = 250
        mpld3.draw_figure("compute_duration_multiline_plot_predict", data.json);
    }

    data = next_widget.getWidget(
        {
        "app_id": "{{ app_id }}",
        "exp_uid": "{{ exp_uid }}",
        'name': 'getStats',
        'widget_key': "{{ perm_key }}",
        "args":{
        "stat_id" : "compute_duration_multiline_plot",
        "params"  : {"task": "predict" } }
        },
        plot_response
        )

    plot_response = function(data) {
        data.json['width'] = 250
        data.json['height'] = 250
        mpld3.draw_figure("compute_duration_multiline_plot_daemonProcess", data.json);
    }

    data = next_widget.getWidget(
        {
        "app_id": "{{ app_id }}",
        "exp_uid": "{{ exp_uid }}",
        'name': 'getStats',
        'widget_key': "{{ perm_key }}",
        "args":{
        "stat_id" : "compute_duration_multiline_plot",
        "params"  : {"task": "daemonProcess" } }
        },
        plot_response
        )
</script>



<!--###################### compute_duration_detailed_stacked_atea_plots for each algorithm ###################-->
<div class="container-fluid" style ='padding-bottom: 1cm'>
    <div class="col-lg-10 col-lg-offset-1">
        <h2> Individual algorithm timing breakdown
            <button type="button" class="btn btn-primary btn-xs"
                  onclick="popup_alert('The same graphs \'Algorithm timing comparison\' but now shown with tabs for each different algorithm. In each call for a particular algorithm and particular API call (i.e., getQuery\'s compute) is graphed so you can see the relative time each one takes.')">?</button>
        </h2>
    </div>
    <div class="col-lg-10 col-lg-offset-1">

        <ul class="nav nav-tabs" role="tablist">
            {% for alg in alg_list %}
                {% if loop.first %}
                    <li role="presentation" class="active"><a href="#compute_duration_detailed_{{ alg.alg_label_clean }}" aria-controls="compute_duration_detailed_{{ alg.alg_label_clean }}" role="tab" data-toggle="tab">{{ alg.alg_label_clean }}</a></li>
                {% else %}
                    <li role="presentation"><a href="#compute_duration_detailed_{{ alg.alg_label_clean }}" aria-controls="compute_duration_detailed_{{ alg.alg_label_clean }}" role="tab" data-toggle="tab">{{ alg.alg_label_clean }}</a></li>
                {% endif %}
            {% endfor %}
        </ul>

        <div class="tab-content">
            {% for alg in alg_list %}
                {% if loop.first %}
                    <div role="tabpanel" class="tab-pane active" id="compute_duration_detailed_{{ alg.alg_label_clean }}">
                        <div class="col-md-3">
                            <div id= "compute_duration_detailed_stacked_area_plot_getQuery_{{ alg.alg_label_clean }}"></div>
                        </div>
                        <div class="col-md-3">
                            <div id= "compute_duration_detailed_stacked_area_plot_processAnswer_{{ alg.alg_label_clean }}"></div>
                        </div>
                        <div class="col-md-3">
                            <div id= "compute_duration_detailed_stacked_area_plot_predict_{{ alg.alg_label_clean }}"></div>
                        </div>
                        <div class="col-md-3">
                            <div id= "compute_duration_detailed_stacked_area_plot_daemonProcess_{{ alg.alg_label_clean }}"></div>
                        </div>
                    </div>
                {% else %}
                    <div role="tabpanel" class="tab-pane" id="compute_duration_detailed_{{ alg.alg_label_clean }}">
                        <div class="col-md-3">
                            <div id= "compute_duration_detailed_stacked_area_plot_getQuery_{{ alg.alg_label_clean }}"></div>
                        </div>
                        <div class="col-md-3">
                            <div id= "compute_duration_detailed_stacked_area_plot_processAnswer_{{ alg.alg_label_clean }}"></div>
                        </div>
                        <div class="col-md-3">
                            <div id= "compute_duration_detailed_stacked_area_plot_predict_{{ alg.alg_label_clean }}"></div>
                        </div>
                        <div class="col-md-3">
                            <div id= "compute_duration_detailed_stacked_area_plot_daemonProcess_{{ alg.alg_label_clean }}"></div>
                        </div>
                    </div>
                {% endif %}




                <script>
                    plot_response = function(data) {
                        data.json['width'] = 250
                        data.json['height'] = 250
                        mpld3.draw_figure("compute_duration_detailed_stacked_area_plot_getQuery_{{ alg.alg_label_clean }}", data.json);
                    }

                    data = next_widget.getWidget(
                    {
                    'app_id': "{{ app_id }}",
                    'exp_uid': "{{ exp_uid }}",
                    'name': 'getStats',
                    'widget_key': "{{ perm_key }}",
                    'args':{
                    'stat_id' : 'compute_duration_detailed_stacked_area_plot',
                    'params'  : {'task':'getQuery', 'alg_label':'{{ alg.alg_label }}' }
                    }
                    },
                    plot_response
                    );


                    plot_response = function(data) {
                        data.json['width'] = 250
                        data.json['height'] = 250
                        mpld3.draw_figure("compute_duration_detailed_stacked_area_plot_processAnswer_{{ alg.alg_label_clean }}", data.json);
                    }

                    data = next_widget.getWidget(
                    {
                    'app_id': "{{ app_id }}",
                    'exp_uid': "{{ exp_uid }}",
                    'name': 'getStats',
                    'widget_key': "{{ perm_key }}",
                    'args':{
                    'stat_id' : 'compute_duration_detailed_stacked_area_plot',
                    'params'  : {'task':'processAnswer', 'alg_label':'{{ alg.alg_label }}' }
                    }
                    },
                    plot_response
                    );


                    plot_response = function(data) {
                        data.json['width'] = 250
                        data.json['height'] = 250
                        mpld3.draw_figure("compute_duration_detailed_stacked_area_plot_predict_{{ alg.alg_label_clean }}", data.json);
                    }


                    data = next_widget.getWidget(
                    {
                    'app_id': "{{ app_id }}",
                    'exp_uid': "{{ exp_uid }}",
                    'name': 'getStats',
                    'widget_key': "{{ perm_key }}",
                    'args':{
                    'stat_id' : 'compute_duration_detailed_stacked_area_plot',
                    'params'  : {'task':'predict', 'alg_label':'{{ alg.alg_label }}' }
                    }
                    },
                    plot_response
                    );


                    plot_response = function(data) {
                        data.json['width'] = 250
                        data.json['height'] = 250
                        mpld3.draw_figure("compute_duration_detailed_stacked_area_plot_daemonProcess_{{ alg.alg_label_clean }}", data.json);
                    }


                    data = next_widget.getWidget(
                    {
                    'app_id': "{{ app_id }}",
                    'exp_uid': "{{ exp_uid }}",
                    'name': 'getStats',
                    'widget_key': "{{ perm_key }}",
                    'args':{
                    'stat_id' : 'compute_duration_detailed_stacked_area_plot',
                    'params'  : {'task':'daemonProcess', 'alg_label':'{{ alg.alg_label }}' }
                    }
                    },
                    plot_response
                    );

                </script>
            {% endfor %}
        </div>
    </div>
</div>



<!--###################### network_delay_histogram #######################-->
<div class="container-fluid" style ='padding-bottom: 1cm; background-color: #FFFFFF'>
    <div class="col-lg-10 col-lg-offset-1">
        <h2> Client-side timing
            <button type="button" class="btn btn-primary btn-xs"
                  onclick="popup_alert('A histogram showing how long it took for each query. For each algorithm it is shown (a) the time it took for participants to answer a question (response time) and (b) the time required to present a question (network delay).')">?</button>
        </h2>
    </div>
    <div class="col-lg-10 col-lg-offset-1">

        <ul class="nav nav-tabs" role="tablist">
            {% for alg in alg_list %}
                {% if loop.first %}
                    <li role="presentation" class="active"><a href="#client_times_{{ alg.alg_label_clean }}" aria-controls="client_times_{{ alg.alg_label_clean }}" role="tab" data-toggle="tab">{{ alg.alg_label_clean }}</a></li>
                {% else %}
                    <li role="presentation"><a href="#client_times_{{ alg.alg_label_clean }}" aria-controls="client_times_{{ alg.alg_label_clean }}" role="tab" data-toggle="tab">{{ alg.alg_label_clean }}</a></li>
                {% endif %}
            {% endfor %}
        </ul>

        <div class="tab-content">
            {% for alg in alg_list %}
                {% if loop.first %}
                    <div role="tabpanel" class="tab-pane active" id="client_times_{{ alg.alg_label_clean }}">
                        <div class="col-md-3">
                            <div id = "response_time_histogram_{{ alg.alg_label_clean }}"></div>
                        </div>
                        <div class="col-md-3">
                            <div id = "network_delay_histogram_{{ alg.alg_label_clean }}"></div>
                        </div>
                    </div>
                {% else %}
                    <div role="tabpanel" class="tab-pane" id="client_times_{{ alg.alg_label_clean }}">
                        <div class="col-md-3">
                            <div id = "response_time_histogram_{{ alg.alg_label_clean }}"></div>
                        </div>
                        <div class="col-md-3">
                            <div id = "network_delay_histogram_{{ alg.alg_label_clean }}"></div>
                        </div>
                    </div>
                {% endif %}
            <!-- <div role="tabpanel" class="tab-pane active" id="home"> -->


            <script>
                plot_response = function(data) {
                    data.json['width'] = 250
                    data.json['height'] = 250
                    mpld3.draw_figure("response_time_histogram_{{ alg.alg_label_clean }}", data.json);
                }

                data = next_widget.getWidget(
                {
                'app_id': "{{ app_id }}",
                'exp_uid': "{{ exp_uid }}",
                'name': 'getStats',
                'widget_key': "{{ perm_key }}",
                'args':{
                'stat_id' : 'response_time_histogram',
                'params'  : {'alg_label':'{{ alg.alg_label }}'}
                }
                },
                plot_response
                );

                plot_response = function(data) {
                    data.json['width'] = 250
                    data.json['height'] = 250
                    mpld3.draw_figure("network_delay_histogram_{{ alg.alg_label_clean }}", data.json);
                }

                data = next_widget.getWidget(
                {
                'app_id': "{{ app_id }}",
                'exp_uid': "{{ exp_uid }}",
                'name': 'getStats',
                'widget_key': "{{ perm_key }}",
                'args':{
                'stat_id' : 'network_delay_histogram',
                'params'  : {'alg_label':'{{ alg.alg_label }}'}
                }
                },
                plot_response
                );

            </script>
            {% endfor %}
        </div>

    </div>
</div>


<!--##################### most_current_embedding ################ -->
<div class="container-fluid" style ='padding-bottom: 1cm; background-color: #FFFFFF'>
    <div class="col-lg-10 col-lg-offset-1">
        <h2> Rankings
            <button type="button" class="btn btn-primary btn-xs"
                  onclick="popup_alert('The ranking of the objects, accordingt to the instructions. For example, if you said \'Select the funniest caption.\' in your instructions, the funniest captions would appear at the top of this ranking.')">?</button>
        </h2>
    </div>
    <div class="col-lg-10 col-lg-offset-1">

        <ul class="nav nav-tabs" role="tablist">
            {% for alg in alg_list %}
                {% if loop.first %}
                    <li role="presentation" class="active"><a href="#ranking_{{ alg.alg_label_clean }}" aria-controls="ranking_{{ alg.alg_label_clean }}" role="tab" data-toggle="tab">{{ alg.alg_label_clean }}</a></li>
                {% else %}
                    <li role="presentation"><a href="#ranking_{{ alg.alg_label_clean }}" aria-controls="ranking_{{ alg.alg_label_clean }}" role="tab" data-toggle="tab">{{ alg.alg_label_clean }}</a></li>
                {% endif %}
            {% endfor %}
        </ul>


        <div class="tab-content">
            {% for alg in alg_list %}
                {% if loop.first %}
                    <div role="tabpanel" class="tab-pane active" id="ranking_{{ alg.alg_label_clean }}">
                        <div id = "most_current_ranking_{{ alg.alg_label_clean }}"></div>
                    </div>
                {% else %}
                    <div role="tabpanel" class="tab-pane" id="ranking_{{ alg.alg_label_clean }}">
                        <div id = "most_current_ranking_{{ alg.alg_label_clean }}"></div>
                    </div>
                {% endif %}
            <!-- <div role="tabpanel" class="tab-pane active" id="home"> -->


            <script>
              plot_response = function(data) {
              charts.createDynamicTable(data.json, "most_current_ranking_{{ alg.alg_label_clean }}")
              }

              data = next_widget.getWidget(
              {
              'app_id': "{{ app_id }}",
              'exp_uid': "{{ exp_uid }}",
              'name': 'getStats',
              'widget_key': "{{ perm_key }}",
              'args':{
              'stat_id' : 'most_current_ranking',
              'params'  : {'alg_label': "{{ alg.alg_label }}" }
              }
              },
              plot_response
              );
            </script>
            {% endfor %}
        </div>

    </div>
</div>



{% endblock %}
